<!DOCTYPE html>
<html>
<head>
  <title>Test Closest Post Office Function</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    .test-result { padding: 10px; margin: 5px 0; border-radius: 5px; }
    .pass { background: #d4edda; color: #155724; }
    .fail { background: #f8d7da; color: #721c24; }
    button { margin: 10px 0; }
    .object-details { font-family: monospace; font-size: 14px; background: #f8f9fa; padding: 10px; border-radius: 5px; margin-top: 5px; max-height: 200px; overflow: auto; }
  </style>
</head>
<body>
  <h1>üß™ Test Closest Post Office Function</h1>
  <p><strong>Function returns full post office OBJECT</strong>. Edit <code>script.js</code>, save, refresh. Tests verify correct object!</p>
  
  <button onclick="runTests()">üöÄ Run Tests</button>
  <div id="results"></div>
  
  <h3>Test Cases (Exact Coords ‚Üí Expected Full Object):</h3>
  <ul>
    <li><strong>Test 1:</strong> Cape Town (-33.9249, 18.4241) ‚Üí Full "Cape Town Central" object</li>
    <li><strong>Test 2:</strong> Johannesburg (-26.2041, 28.0473) ‚Üí Full "Johannesburg Central" object</li>
    <li><strong>Test 3:</strong> Durban (-29.8587, 31.0218) ‚Üí Full "Durban Central" object</li>
  </ul>
  
  <script src="mailhubs_south_africa.js"></script>
  <script src="script.js"></script>
  <script>
    console.log('postOffices loaded:', postOffices.length);

    // Expected full objects (extracted from data)
    const expectedObjects = {
      capeTown: postOffices.find(h => h.location === 'Cape Town Central'),
      johannesburg: postOffices.find(h => h.location === 'Johannesburg Central'),
      durban: postOffices.find(h => h.location === 'Durban Central')
    };

    function objectsMatch(obj1, obj2) {
      return obj1 && obj2 && 
        obj1.location === obj2.location &&
        obj1.longitude === obj2.longitude &&
        obj1.latitude === obj2.latitude;
    }

    function formatObject(obj) {
      if (!obj) return 'null';
      return `<strong>${obj.location}</strong><br>
        Hours: ${obj.operatingHours}<br>
        Processing: ${obj.processingTimeHrs}hrs<br>
        Coords: ${obj.latitude.toFixed(4)}, ${obj.longitude.toFixed(4)}`;
    }

    function runTests() {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';

      const tests = [
        {
          name: 'Test 1: Cape Town',
          lat: -33.9249,
          lng: 18.4241,
          expected: expectedObjects.capeTown
        },
        {
          name: 'Test 2: Johannesburg',
          lat: -26.2041,
          lng: 28.0473,
          expected: expectedObjects.johannesburg
        },
        {
          name: 'Test 3: Durban',
          lat: -29.8587,
          lng: 31.0218,
          expected: expectedObjects.durban
        }
      ];

      let allPassed = true;
      tests.forEach(test => {
        try {
          const closest = closestPostOffice(test.lat, test.lng, postOffices);
          const pass = objectsMatch(closest, test.expected);
          allPassed = allPassed && pass;

          const resultDiv = document.createElement('div');
          resultDiv.className = `test-result ${pass ? 'pass' : 'fail'}`;
          resultDiv.innerHTML = `<strong>${test.name}:</strong> ${pass ? '‚úÖ PASS' : '‚ùå FAIL'}<br>
            <strong>Input:</strong> lat=${test.lat}, lng=${test.lng}<br>
            <strong>Got Object:</strong><div class="object-details">${formatObject(closest)}</div>
            <strong>Expected Object:</strong><div class="object-details">${formatObject(test.expected)}</div>`;
          resultsDiv.appendChild(resultDiv);

          // Console full objects
          console.log(`${test.name}:`, { input: {lat: test.lat, lng: test.lng}, got: closest, expected: test.expected });
        } catch (e) {
          const resultDiv = document.createElement('div');
          resultDiv.className = 'test-result fail';
          resultDiv.innerHTML = `${test.name}: ‚ùå ERROR - ${e.message}`;
          resultsDiv.appendChild(resultDiv);
          allPassed = false;
        }
      });

      if (allPassed) {
        resultsDiv.innerHTML += '<div class="test-result pass" style="font-size: 18px;"><strong>üéâ ALL TESTS PASSED! Full objects match. Commit & push!</strong></div>';
      }
    }

    // Auto-run on load
    window.onload = runTests;
  </script>
</body>
</html>